{
    "variables": {
        "aws_access_key": "",
        "aws_secret_key": "",
        "clean_general": "true",
        "instance_type": "",
        "optimise_win_volume": "true",
        "vpc_id": "",
        "subnet_id": "",
        "vpc_private_sg_id": "",
        "vpc_private_sn_id": "",
        "vpc_region": "",
        "winrm_username": ""
    },
    "builders": [
        {
            "access_key": "{{ user `aws_access_key` }}",
            "ami_name": "windows2012r2-packer-demo-{{timestamp}}",
            "communicator": "winrm",
            "instance_type": "{{ user `instance_type` }}",
            "launch_block_device_mappings": [
                {
                    "delete_on_termination": "true",
                    "device_name": "/dev/sda1",
                    "volume_size": "50",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvdb",
                    "encrypted": "true",
                    "snapshot_id": "snap-047a1b65379998e97",
                    "volume_size": "8",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvdc",
                    "encrypted": "true",
                    "snapshot_id": "snap-05fcfa3324c2ab7bc",
                    "volume_size": "100",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvdd",
                    "encrypted": "true",
                    "snapshot_id": "snap-072d38f11ffb7b529",
                    "volume_size": "101",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvde",
                    "encrypted": "true",
                    "snapshot_id": "snap-072d38f11ffb7b529",
                    "volume_size": "102",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvdf",
                    "encrypted": "true",
                    "snapshot_id": "snap-0107c59783b2f5182",
                    "volume_size": "103",
                    "volume_type": "gp2"
                },
                {
                    "delete_on_termination": "true",
                    "device_name": "xvdg",
                    "encrypted": "true",
                    "snapshot_id": "snap-081c5c33b7f6743aa",
                    "volume_size": "10",
                    "volume_type": "gp2"
                }
            ],
            "region": "{{ user `vpc_region` }}",
            "secret_key": "{{ user `aws_secret_key` }}",
            "source_ami_filter": {
                "filters": {
                    "name": "*Windows_Server-2012-R2*English-64Bit-Base*",
                    "root-device-type": "ebs",
                    "virtualization-type": "hvm"
                },
                "most_recent": true,
                "owners": "amazon"
            },
            "subnet_id": "{{ user `vpc_private_sn_id` }}",
            "type": "amazon-ebs",
            "user_data_file": "./bootstrap/BootstrapWin.txt",
            "vpc_id": "{{ user `vpc_id` }}",
            "winrm_password": "{{ user `winrm_password` }}",
            "winrm_username": "{{ user `winrm_username` }}"
        }
    ],
    "provisioners": [
        {
            "environment_vars": [
                "DEVOPS_LIFE_IMPROVER=PACKER"
            ],
            "inline": [
                "Write-Host \"HELLO NEW USER; WELCOME TO $Env:DEVOPS_LIFE_IMPROVER\"",
                "Write-Host \"You need to use backtick escapes when using\"",
                "Write-Host \"characters such as DOLLAR`$ directly in a command\"",
                "Write-Host \"or in your own scripts.\""
            ],
            "type": "powershell"
        },
        {
            "environment_vars": [
                "VAR1=A$Dollar",
                "VAR2=A`Backtick",
                "VAR3=A'SingleQuote",
                "VAR4=A\"DoubleQuote"
            ],
            "script": "./scripts/StandardScriptTest.ps1",
            "type": "powershell"
        },
        {
            "elevated_password": "SuperS3cr3t!",
            "elevated_user": "Administrator",
            "environment_vars": [
                "FOO=bar"
            ],
            "scripts": [
                "./scripts/DotNetOptimizationSpeedUp.ps1"
            ],
            "type": "powershell"
        },
        {
            "elevated_password": "SuperS3cr3t!",
            "elevated_user": "Administrator",
            "environment_vars": [
                "CLEAN_GENERAL={{user `clean_general`}}"
            ],
            "scripts": [
                "./scripts/CleanGeneral.ps1"
            ],
            "type": "powershell"
        },
        {
            "elevated_password": "SuperS3cr3t!",
            "elevated_user": "Administrator",
            "environment_vars": [
                "OPTIMISE_WIN_VOLUME={{user `optimise_win_volume`}}"
            ],
            "scripts": [
                "./scripts/OptimiseWindowsVolume.ps1"
            ],
            "type": "powershell"
        }
    ]
}
